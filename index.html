<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Cámara Universal</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; }
        #start-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px 40px; font-size: 1.5rem; cursor: pointer; z-index: 10; }
        #ar-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        #ar-video { display: none; }
    </style>
</head>
<body>
    <button id="start-button">Empezar Prueba de Cámara</button>
    <video id="ar-video" playsinline autoplay muted></video>
    <canvas id="ar-canvas"></canvas>

    <script>
        const startButton = document.getElementById('start-button');
        const videoElement = document.getElementById('ar-video');
        const canvasElement = document.getElementById('ar-canvas');
        const canvasCtx = canvasElement.getContext('2d');

        startButton.addEventListener('click', startCamera);

        async function startCamera() {
            console.log("Botón presionado. Intentando acceder a la cámara...");
            startButton.style.display = 'none';

            try {
                // --- ¡ESTE ES EL CAMBIO CLAVE! ---
                // En lugar de pedir una cámara 'environment' específica,
                // simplemente pedimos 'video: true'. Esto le dice al navegador:
                // "Dame cualquier cámara de video que tengas". Es universal.
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true 
                });
                // ------------------------------------

                videoElement.srcObject = stream;
                videoElement.onloadedmetadata = () => {
                    console.log("Metadatos del video cargados. Dimensiones:", videoElement.videoWidth, videoElement.videoHeight);
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                    renderLoop();
                };

            } catch (error) {
                console.error("FALLO CRÍTICO AL ACCEDER A LA CÁMARA:", error);
                alert("No se pudo acceder a la cámara. Revisa los permisos en tu navegador. Error: " + error.message);
                startButton.style.display = 'block';
            }
        }

        function renderLoop() {
            // En modo selfie (la mayoría de las webcams), queremos el efecto espejo.
            // Para ello, volteamos el canvas horizontalmente antes de dibujar.
            canvasCtx.save();
            canvasCtx.scale(-1, 1);
            canvasCtx.drawImage(videoElement, -canvasElement.width, 0, canvasElement.width, canvasElement.height);
            canvasCtx.restore();
            
            requestAnimationFrame(renderLoop);
        }
    </script>
</body>
</html>