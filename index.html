<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Cámara Mínima</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; }
        #start-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px 40px; font-size: 1.5rem; cursor: pointer; z-index: 10; }
        #ar-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        #ar-video { display: none; }
    </style>
</head>
<body>
    <button id="start-button">Empezar Prueba de Cámara</button>
    <video id="ar-video" playsinline autoplay muted></video>
    <canvas id="ar-canvas"></canvas>

    <script>
        // Referencias a los únicos 3 elementos que nos importan.
        const startButton = document.getElementById('start-button');
        const videoElement = document.getElementById('ar-video');
        const canvasElement = document.getElementById('ar-canvas');
        const canvasCtx = canvasElement.getContext('2d');

        // Ponemos el "oyente" en el botón.
        startButton.addEventListener('click', startCamera);

        async function startCamera() {
            console.log("Botón presionado. Intentando acceder a la cámara...");
            
            // Ocultamos el botón para que no moleste.
            startButton.style.display = 'none';

            try {
                // 1. Pedimos permiso para usar la cámara.
                // Usamos la configuración más simple posible.
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } // Empezamos con la trasera.
                });

                // 2. Si nos dan permiso, la conectamos al elemento de video.
                videoElement.srcObject = stream;

                // 3. Esperamos a que el video esté listo para reproducirse.
                videoElement.onloadedmetadata = () => {
                    console.log("Metadatos del video cargados. Dimensiones:", videoElement.videoWidth, videoElement.videoHeight);
                    // Sincronizamos el tamaño del canvas con el del video.
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                    
                    // 4. Empezamos el bucle para dibujar el video en la pantalla.
                    renderLoop();
                };

            } catch (error) {
                // Si algo falla, CUALQUIER COSA, nos lo dirá.
                console.error("FALLO CRÍTICO AL ACCEDER A LA CÁMARA:", error);
                alert("No se pudo acceder a la cámara. Revisa los permisos en tu navegador o sistema operativo. Error: " + error.message);
                // Si falla, volvemos a mostrar el botón para que puedas intentarlo de nuevo.
                startButton.style.display = 'block';
            }
        }

        // Bucle de dibujo. Su única misión es copiar la imagen del video al canvas.
        function renderLoop() {
            canvasCtx.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
            requestAnimationFrame(renderLoop);
        }
    </script>
</body>
</html>